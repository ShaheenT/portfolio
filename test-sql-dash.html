<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Analyst - Live SQL Testing Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }
        h1 { font-size: 2.5em; margin-bottom: 10px; }
        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        .col-4 { grid-column: span 4; }
        .col-6 { grid-column: span 6; }
        .col-8 { grid-column: span 8; }
        .col-12 { grid-column: span 12; }
        .card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.15);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }
        .card-title { font-size: 1.4em; font-weight: 600; }
        .sql-editor {
            background: #1a1f2e;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 15px 0;
            border: 1px solid rgba(245, 87, 108, 0.3);
            min-height: 200px;
        }
        textarea {
            width: 100%;
            background: transparent;
            border: none;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            resize: vertical;
            outline: none;
            min-height: 150px;
        }
        .btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }
        .results-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th {
            background: rgba(240, 147, 251, 0.2);
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        .results-table td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .results-table tr:hover {
            background: rgba(255,255,255,0.05);
        }
        .metric-box {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin: 10px 0;
        }
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #f093fb;
        }
        .metric-label { font-size: 0.9em; opacity: 0.8; margin-top: 5px; }
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .status-pass { background: rgba(74, 222, 128, 0.3); color: #4ade80; }
        .status-fail { background: rgba(239, 68, 68, 0.3); color: #ef4444; }
        .status-warning { background: rgba(251, 191, 36, 0.3); color: #fbbf24; }
        .console {
            background: #1a1f2e;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .console-line { margin: 5px 0; }
        .pass { color: #4ade80; }
        .fail { color: #ef4444; }
        .info { color: #60a5fa; }
        .warning { color: #fbbf24; }
        .chart-container {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .bar-chart {
            display: flex;
            align-items: flex-end;
            height: 150px;
            gap: 10px;
            margin-top: 15px;
        }
        .bar {
            flex: 1;
            background: linear-gradient(to top, #f093fb, #f5576c);
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: all 0.3s ease;
        }
        .bar:hover {
            opacity: 0.8;
            transform: scaleY(1.05);
        }
        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75em;
            white-space: nowrap;
        }
        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            color: #f093fb;
        }
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .tab-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Test Analyst - Live SQL Testing Dashboard</h1>
            <p style="font-size: 1.2em; opacity: 0.9;">Data Vault | HANA | Financial Services Testing</p>
        </header>

        <div class="grid">
            <!-- SQL Query Editor -->
            <div class="card col-8">
                <div class="card-header">
                    <div class="icon">üîç</div>
                    <div class="card-title">Interactive SQL Query Tester</div>
                </div>
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('reconciliation')">Reconciliation</button>
                    <button class="tab-btn" onclick="switchTab('vault')">Data Vault</button>
                    <button class="tab-btn" onclick="switchTab('cube')">HANA Cube</button>
                </div>
                
                <div id="reconciliation" class="tab-content active">
                    <div class="sql-editor">
                        <textarea id="sqlQuery1">-- Source to Target Reconciliation
SELECT 
    s.policy_id,
    s.premium_total,
    t.premium_total AS target_premium,
    ABS(s.premium_total - t.premium_total) AS variance,
    CASE 
        WHEN ABS(s.premium_total - t.premium_total) < 0.01 THEN 'PASS'
        ELSE 'FAIL'
    END AS status
FROM source_vault s
FULL OUTER JOIN target_hana t ON s.policy_id = t.policy_id
WHERE s.load_date >= CURRENT_DATE - 30;</textarea>
                    </div>
                </div>
                
                <div id="vault" class="tab-content">
                    <div class="sql-editor">
                        <textarea id="sqlQuery2">-- Data Vault Hub Validation
SELECT 
    h.hub_key,
    h.business_key,
    COUNT(s.satellite_key) AS satellite_count,
    MIN(s.load_date) AS first_load,
    MAX(s.load_date) AS last_load
FROM business_vault.policy_hub h
LEFT JOIN business_vault.policy_satellite s 
    ON h.hub_key = s.hub_key
GROUP BY h.hub_key, h.business_key
HAVING COUNT(s.satellite_key) > 0;</textarea>
                    </div>
                </div>
                
                <div id="cube" class="tab-content">
                    <div class="sql-editor">
                        <textarea id="sqlQuery3">-- HANA Cube Aggregation Test
SELECT 
    d.year,
    d.quarter,
    p.product_category,
    SUM(f.premium_amount) AS total_premium,
    COUNT(DISTINCT f.policy_id) AS policy_count,
    AVG(f.premium_amount) AS avg_premium
FROM fact_premium f
JOIN dim_date d ON f.date_key = d.date_key
JOIN dim_product p ON f.product_key = p.product_key
GROUP BY d.year, d.quarter, p.product_category
ORDER BY d.year, d.quarter;</textarea>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn" onclick="executeQuery()">‚ñ∂ Execute Query</button>
                    <button class="btn" onclick="validateQuery()">‚úì Validate SQL</button>
                    <button class="btn" onclick="explainPlan()">üìã Explain Plan</button>
                    <button class="btn" onclick="exportResults()">üíæ Export Results</button>
                </div>
                
                <div id="queryResults"></div>
            </div>

            <!-- Test Execution Stats -->
            <div class="card col-4">
                <div class="card-header">
                    <div class="icon">üìà</div>
                    <div class="card-title">Test Metrics</div>
                </div>
                <div class="metric-box">
                    <div class="metric-value" id="testCount">0</div>
                    <div class="metric-label">Tests Executed</div>
                </div>
                <div class="metric-box">
                    <div class="metric-value" id="accuracy">0%</div>
                    <div class="metric-label">Data Accuracy</div>
                </div>
                <div class="metric-box">
                    <div class="metric-value" id="defects">0</div>
                    <div class="metric-label">Defects Found</div>
                </div>
                <button class="btn" onclick="runFullSuite()" style="width: 100%; margin-top: 15px;">üöÄ Run Full Test Suite</button>
            </div>

            <!-- Data Reconciliation Results -->
            <div class="card col-12">
                <div class="card-header">
                    <div class="icon">‚öñÔ∏è</div>
                    <div class="card-title">Live Data Reconciliation</div>
                </div>
                <div class="console" id="reconConsole">
                    <div class="console-line info">üîß Reconciliation engine ready...</div>
                </div>
                <div style="margin-top: 15px;">
                    <table class="results-table" id="reconTable">
                        <thead>
                            <tr>
                                <th>Policy ID</th>
                                <th>Source Total</th>
                                <th>Target Total</th>
                                <th>Variance</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="reconTableBody">
                            <!-- Results will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- JIRA Integration -->
            <div class="card col-6">
                <div class="card-header">
                    <div class="icon">üìù</div>
                    <div class="card-title">JIRA Test Tracking</div>
                </div>
                <div id="jiraBoard" style="max-height: 350px; overflow-y: auto;">
                    <!-- JIRA items will be added here -->
                </div>
                <button class="btn" onclick="createJiraIssue()">+ Create New Issue</button>
            </div>

            <!-- BI Validation -->
            <div class="card col-6">
                <div class="card-header">
                    <div class="icon">üìä</div>
                    <div class="card-title">BI Output Validation</div>
                </div>
                <select id="biTool" style="width: 100%; padding: 10px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; margin-bottom: 15px;">
                    <option>Tableau Dashboard</option>
                    <option>SAP Analysis for Office</option>
                    <option>SSRS Report</option>
                    <option>Excel Pivot Table</option>
                </select>
                <div class="chart-container">
                    <div style="text-align: center; margin-bottom: 10px; font-weight: 600;">Premium by Quarter</div>
                    <div class="bar-chart" id="biChart">
                        <div class="bar" style="height: 70%;">
                            <span class="bar-value">R2.4M</span>
                            <span class="bar-label">Q1</span>
                        </div>
                        <div class="bar" style="height: 85%;">
                            <span class="bar-value">R2.9M</span>
                            <span class="bar-label">Q2</span>
                        </div>
                        <div class="bar" style="height: 100%;">
                            <span class="bar-value">R3.2M</span>
                            <span class="bar-label">Q3</span>
                        </div>
                        <div class="bar" style="height: 65%;">
                            <span class="bar-value">R2.1M</span>
                            <span class="bar-label">Q4</span>
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="validateBI()">‚úì Validate Against Source</button>
            </div>
        </div>
    </div>

    <script>
        let testCount = 0;
        let defectCount = 0;
        let jiraId = 1001;

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function executeQuery() {
            const console = document.getElementById('reconConsole');
            addConsoleLog('info', '‚ö° Executing SQL query...');
            
            setTimeout(() => {
                addConsoleLog('info', 'üîó Connecting to HANA database...');
                setTimeout(() => {
                    addConsoleLog('pass', '‚úì Query executed successfully');
                    addConsoleLog('info', `üìä Rows returned: ${Math.floor(Math.random() * 500) + 100}`);
                    addConsoleLog('info', `‚è±Ô∏è Execution time: ${(Math.random() * 3 + 0.5).toFixed(2)}s`);
                    
                    generateReconciliationResults();
                    testCount++;
                    document.getElementById('testCount').textContent = testCount;
                    updateAccuracy();
                }, 1000);
            }, 500);
        }

        function generateReconciliationResults() {
            const tbody = document.getElementById('reconTableBody');
            tbody.innerHTML = '';
            
            for (let i = 0; i < 10; i++) {
                const policyId = `POL${String(10000 + i).padStart(6, '0')}`;
                const sourceTotal = (Math.random() * 50000 + 10000).toFixed(2);
                const targetTotal = (parseFloat(sourceTotal) + (Math.random() - 0.7) * 100).toFixed(2);
                const variance = Math.abs(sourceTotal - targetTotal).toFixed(2);
                const status = variance < 1 ? 'PASS' : 'FAIL';
                
                if (status === 'FAIL') defectCount++;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${policyId}</td>
                    <td>R ${sourceTotal}</td>
                    <td>R ${targetTotal}</td>
                    <td>R ${variance}</td>
                    <td><span class="status-badge status-${status.toLowerCase()}">${status}</span></td>
                `;
            }
            
            document.getElementById('defects').textContent = defectCount;
        }

        function validateQuery() {
            addConsoleLog('info', 'üîç Validating SQL syntax...');
            setTimeout(() => {
                addConsoleLog('pass', '‚úì Syntax valid');
                addConsoleLog('pass', '‚úì All tables exist');
                addConsoleLog('pass', '‚úì Join conditions verified');
            }, 800);
        }

        function explainPlan() {
            addConsoleLog('info', 'üìã Generating execution plan...');
            setTimeout(() => {
                addConsoleLog('info', '‚îú‚îÄ Sequential Scan on business_vault.policy_hub');
                addConsoleLog('info', '‚îú‚îÄ Hash Join (cost=1250.00)');
                addConsoleLog('info', '‚îî‚îÄ Index Scan on target_hana (cost=450.00)');
                addConsoleLog('pass', '‚úì Execution plan optimized');
            }, 1000);
        }

        function exportResults() {
            addConsoleLog('info', 'üíæ Exporting results to CSV...');
            setTimeout(() => {
                addConsoleLog('pass', `‚úì File saved: reconciliation_${Date.now()}.csv`);
            }, 600);
        }

        function runFullSuite() {
            addConsoleLog('info', 'üöÄ Starting full test suite...');
            let tests = ['Hub Validation', 'Link Integrity', 'Satellite History', 'Business Vault Logic', 'SSRS Reports'];
            let delay = 0;
            
            tests.forEach((test, idx) => {
                setTimeout(() => {
                    const status = Math.random() > 0.2 ? 'pass' : 'fail';
                    addConsoleLog(status, `${status === 'pass' ? '‚úì' : '‚úó'} ${test}: ${status.toUpperCase()}`);
                    testCount++;
                    document.getElementById('testCount').textContent = testCount;
                    if (status === 'fail') {
                        defectCount++;
                        document.getElementById('defects').textContent = defectCount;
                        createJiraIssue(`Data validation failed in ${test}`);
                    }
                    updateAccuracy();
                }, delay += 1200);
            });
        }

        function createJiraIssue(description = null) {
            const jiraBoard = document.getElementById('jiraBoard');
            const issue = document.createElement('div');
            const issueType = description ? 'Bug' : 'Test Case';
            const priority = Math.random() > 0.5 ? 'High' : 'Medium';
            
            issue.style.cssText = 'background: rgba(0,0,0,0.3); padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #f5576c;';
            issue.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <strong>TST-${jiraId++}</strong>
                    <span class="status-badge status-${issueType === 'Bug' ? 'fail' : 'pass'}">${issueType}</span>
                </div>
                <div style="margin-top: 8px; font-size: 0.9em;">
                    ${description || 'Data reconciliation test case - ' + new Date().toLocaleTimeString()}
                </div>
                <div style="margin-top: 8px; font-size: 0.85em; opacity: 0.8;">
                    Priority: ${priority} | Assigned: Test Team
                </div>
            `;
            jiraBoard.insertBefore(issue, jiraBoard.firstChild);
            addConsoleLog('info', `üìù JIRA issue created: TST-${jiraId - 1}`);
        }

        function validateBI() {
            const tool = document.getElementById('biTool').value;
            addConsoleLog('info', `üìä Validating ${tool}...`);
            
            setTimeout(() => {
                addConsoleLog('info', 'üîó Connecting to source data...');
                setTimeout(() => {
                    const variance = (Math.random() * 2).toFixed(2);
                    if (variance < 1) {
                        addConsoleLog('pass', `‚úì BI output matches source data (variance: ${variance}%)`);
                    } else {
                        addConsoleLog('fail', `‚úó Data mismatch detected (variance: ${variance}%)`);
                        defectCount++;
                        document.getElementById('defects').textContent = defectCount;
                    }
                    testCount++;
                    document.getElementById('testCount').textContent = testCount;
                    updateAccuracy();
                }, 1000);
            }, 500);
        }

        function updateAccuracy() {
            const accuracy = ((testCount - defectCount) / Math.max(testCount, 1) * 100).toFixed(1);
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        function addConsoleLog(type, message) {
            const console = document.getElementById('reconConsole');
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            line.textContent = message;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }

        // Initialize JIRA board
        for (let i = 0; i < 3; i++) {
            createJiraIssue();
        }
    </script>
</body>
</html>